functions for version 3